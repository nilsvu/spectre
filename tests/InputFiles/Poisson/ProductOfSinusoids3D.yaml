# Distributed under the MIT License.
# See LICENSE.txt for details.

# Executable: SolvePoisson3D
# Check: parse;execute_check_output
# Timeout: 10
# ExpectedOutput:
#   PoissonProductOfSinusoids3DReductions.h5
#   PoissonProductOfSinusoids3DVolume0.h5
# OutputFileChecks:
#   - Label: Discretization error
#     Subfile: /ErrorNorms.dat
#     FileGlob: PoissonProductOfSinusoids3DReductions.h5
#     SkipColumns: [0, 1, 2]
#     AbsoluteTolerance: 0.004

ResourceInfo:
  AvoidGlobalProc0: false
  Singletons: Auto

Background:
  MathFunction:
    Function:
      Gaussian:
        Amplitude: 1.
        Width: 1.
        Center: [0., 0., 0.]

InitialGuess:
  Zero:

RandomizeInitialGuess: None

DomainCreator:
  Sphere:
    InnerRadius: 0.2
    OuterRadius: 1e4
    InnerCubeSphericity: 0.
    UseEquiangularMap: True
    RadialPartitioning: [0.5, 2.]
    RadialDistribution: [Linear, Logarithmic, Inverse]
    InitialRefinement:
      InnerCube: [1, 1, 1]
      Shell0:    [1, 1, 1]
      Shell1:    [1, 1, 2]
      Shell2:    [1, 1, 2]
    InitialGridPoints: 6
    TimeDependence: None
    BoundaryCondition:
      AnalyticSolution:
        Field: Dirichlet

Discretization:
  DiscontinuousGalerkin:
    PenaltyParameter: 1.
    Massive: True

Observers:
  VolumeFileName: "PoissonProductOfSinusoids3DVolume"
  ReductionFileName: "PoissonProductOfSinusoids3DReductions"

LinearSolver:
  ConvergenceCriteria:
    MaxIterations: 30
    RelativeResidual: 1.e-10
    AbsoluteResidual: 1.e-10
  Verbosity: Quiet

  Multigrid:
    Iterations: 1
    MaxLevels: Auto
    PreSmoothing: True
    PostSmoothingAtBottom: False
    Verbosity: Silent
    OutputVolumeData: False

  SchwarzSmoother:
    Iterations: 3
    MaxOverlap: 2
    Verbosity: Silent
    SubdomainSolver: ExplicitInverse
    ObservePerCoreReductions: False

EventsAndTriggers:
  - - Always
    - - ObserveNorms:
          SubfileName: ErrorNorms
          TensorsToObserve:
            - Name: Error(Field)
              NormType: L2Norm
              Components: Sum
      - ObserveFields:
          SubfileName: VolumeData
          VariablesToObserve: [Field, Error(Field), LinearResidual(Field)]
          InterpolateToMesh: None
          CoordinatesFloatingPointType: Double
          FloatingPointTypes: [Double]
          OverrideObservationValue: None
